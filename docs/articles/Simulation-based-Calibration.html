<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation-based Calibration • EMC2</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation-based Calibration">
<meta name="description" content="A guide to SBC in EMC2">
<meta property="og:description" content="A guide to SBC in EMC2">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EMC2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Simulation-based-Calibration.html">Simulation-based Calibration</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ampl-psych/EMC2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation-based Calibration</h1>
                        <h4 data-toc-skip class="author">Niek
Stevenson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ampl-psych/EMC2/blob/HEAD/vignettes/Simulation-based-Calibration.Rmd" class="external-link"><code>vignettes/Simulation-based-Calibration.Rmd</code></a></small>
      <div class="d-none name"><code>Simulation-based-Calibration.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Simulation-based calibration(SBC) is a technique used to validate and
calibrate Bayesian estimation methods and models <span class="citation">(Talts et al. 2018)</span>. SBC checks whether a model
correctly accounts for uncertainty and whether the posterior
distributions it produces are consistent with the true data-generating
process. First we outline how to perform SBC in theory, after which we
describe our experiences with SBC in <em>EMC2</em>, which will also
illustrate how to perform SBC for your own model.</p>
</div>
<div class="section level2">
<h2 id="how-to-sbc">How to SBC<a class="anchor" aria-label="anchor" href="#how-to-sbc"></a>
</h2>
<p>Here we briefly outline the steps to performing SBC, for more detail
we refer the reader to <span class="citation">Talts et al.
(2018)</span>.</p>
<div class="section level3">
<h3 id="specify-the-probabilistic-model">1. Specify the Probabilistic Model<a class="anchor" aria-label="anchor" href="#specify-the-probabilistic-model"></a>
</h3>
<ul>
<li>Define the Bayesian model you’re working with. This includes
specifying the prior distribution for the parameters and the likelihood
function that connects the data to the parameters.</li>
<li>For example, suppose you have a model with a set of parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and observed data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y \sim p(y|\alpha)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha \sim p(\alpha)</annotation></semantics></math>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="simulate-parameters-and-data">2. Simulate Parameters and Data<a class="anchor" aria-label="anchor" href="#simulate-parameters-and-data"></a>
</h3>
<ul>
<li>
<strong>Sample Parameters</strong>: Draw a large number of sets of
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>
from the prior distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\alpha)</annotation></semantics></math>.</li>
<li>
<strong>Simulate Data</strong>: For each set of parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>,
simulate a dataset
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">y^{(i)}</annotation></semantics></math>
from the likelihood
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(y|\alpha^{(i)})</annotation></semantics></math>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="compute-posterior-distributions">3. Compute Posterior Distributions<a class="anchor" aria-label="anchor" href="#compute-posterior-distributions"></a>
</h3>
<ul>
<li>For each simulated dataset
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">y^{(i)}</annotation></semantics></math>,
compute the posterior distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\alpha | y^{(i)})</annotation></semantics></math>
using your Bayesian model.</li>
</ul>
</div>
<div class="section level3">
<h3 id="evaluate-the-rank-statistics">4. Evaluate the Rank Statistics<a class="anchor" aria-label="anchor" href="#evaluate-the-rank-statistics"></a>
</h3>
<ul>
<li>For each simulated dataset, determine where the set of true
parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>
ranks in the posterior samples of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.
In <em>EMC2</em> we thin the posterior to be equal to the effective
sample size. The rank is essentially the number of posterior samples
that are less than the true
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>.</li>
<li>Normalize the ranks to lie between 0 and 1. This is your
<strong>rank statistic</strong>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="check-uniformity">5. Check Uniformity<a class="anchor" aria-label="anchor" href="#check-uniformity"></a>
</h3>
<ul>
<li>Aggregate the rank statistics across all simulated data-sets. If
your model is well-calibrated, the ranks should be uniformly distributed
because each posterior should correctly reflect the uncertainty about
the parameter.</li>
<li>Plot the rank statistics. Here we present both histograms of the
rank statistic and plots that compares the empirical cumulative rank to
the cumulative density function of a uniform distribution.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="non-hierarchical-sbc-in-emc2">Non-hierarchical SBC in <em>EMC2</em><a class="anchor" aria-label="anchor" href="#non-hierarchical-sbc-in-emc2"></a>
</h2>
<p><em>EMC2</em> allows for both hierarchical and non-hierarchical
estimation. Given the desirable statistical and estimation properties of
hierarchical models, we normally recommend to use hierarchical models.
However, given that estimating hundreds of models is quite time
consuming and practically unfeasible without a computational server, we
recommend running SBC on non-hierarchical models for typical
applications. Here we use the LBA and DDM to illustrate non-hierarchical
SBC. Later we’ll also perform hierarchical SBC for the LBA, DDM, RDM and
LNR. First we clear our workspace and load <em>EMC2</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ampl-psych.github.io/EMC2/">EMC2</a></span><span class="op">)</span> </span></code></pre></div>
<div class="section level3">
<h3 id="compression">Compression<a class="anchor" aria-label="anchor" href="#compression"></a>
</h3>
<p>Before we start with the SBC, we want to give a quick note on data
compression. By default <em>EMC2</em> compresses RTs to bins of 20ms,
since typical lab set-ups do not allow response times to be measured
with a higher resolution. However, generated data is not subject to the
same physical constraints. Therefore, and to avoid biases, compression
is turned off in the SBC functions. To turn on compression regardless,
you can set <code>compression = TRUE</code>, and set the resolution
using <code>rt_resolution = 0.02</code> (for example) in the
<code>run_sbc</code> function, which will speed up computation but
potentially introduces biases.</p>
</div>
<div class="section level3">
<h3 id="lba">LBA<a class="anchor" aria-label="anchor" href="#lba"></a>
</h3>
<p>To run SBC we specify a design and a prior for the model.
<em>EMC2</em> assumes normal priors on the parameters for
non-hierarchical models. Thus, some parameters are transformed to better
match the normal prior and to satisfy the assumption of the normal
distribution to have full support on the real line. To check the
parameter transformations we use <code><a href="../reference/LBA.html">?LBA</a></code> .</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matchfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="va">d</span><span class="op">$</span><span class="va">S</span> <span class="op">==</span> <span class="va">d</span><span class="op">$</span><span class="va">lR</span></span>
<span></span>
<span><span class="va">design_LBA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span>factors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subjects<span class="op">=</span><span class="fl">1</span>,S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     Rlevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>,</span>
<span>                     matchfun <span class="op">=</span> <span class="va">matchfun</span>,</span>
<span>                     formula <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">v</span><span class="op">~</span><span class="va">lM</span>,<span class="va">B</span><span class="op">~</span><span class="fl">1</span>, <span class="va">t0</span><span class="op">~</span><span class="fl">1</span>, <span class="va">sv</span><span class="op">~</span><span class="fl">1</span>, <span class="va">A</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                     constants<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>sv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     model <span class="op">=</span> <span class="va">LBA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior_LBA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="va">design_LBA</span>, type <span class="op">=</span> <span class="st">"single"</span>,</span>
<span>                  pmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="fl">.7</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  psd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.05</span>, <span class="fl">.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we plot the prior, with <code>map = TRUE</code> (the default) to
see the implied prior on the transformed parameters.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">prior_LBA</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-4-1.png" alt="Prior for LBA non-hierarchical model" width="700"></p>
<p>Next we can simply call <code>run_sbc</code> with our specified
design and prior. We can use <code><a href="../reference/run_sbc.html">?run_sbc</a></code> to see the
description of the function arguments. The trials argument refers to the
number of trials per cell. Since we have an 2-level S factor in our
design (and all other designs used), we will thus simulate 200 trials
per data set. Also note that by default run_sbc will estimate till the
point-scale reduction factor is smaller than 1.1 and the minimum
effective sample size of any of the estimated parameters is larger than
100.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SBC_LBA_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sbc.html">run_sbc</a></span><span class="op">(</span><span class="va">design_LBA</span>, <span class="va">prior_LBA</span>, replicates <span class="op">=</span> <span class="fl">500</span>, trials <span class="op">=</span> <span class="fl">100</span>, plot_data <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  iter <span class="op">=</span> <span class="fl">1000</span>, n_post <span class="op">=</span> <span class="fl">1000</span>, fileName <span class="op">=</span> <span class="st">"SBC_data/SBC_LBA_single.RData"</span>,</span>
<span>                  cores_per_chain <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>In non-hierarchical models, setting <code>cores_per_chain = 30</code>
will estimate 30 simulated data-sets simultaneously. Which is feasible
on the computational server we used. But given that the LBA is so quick
to compute, non-hierarchical SBC is also feasible on a personal
computer. It is recommended to specify <code>fileName</code> to store
intermediary results in case of crashes.</p>
<p><em>EMC2</em> also comes with plotting functions that allow us to
visualize the results. First we can plot the standard histograms, with a
number of equally spaced bins between 0 and 1 of the normalized rank
statistic.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sbc_hist.html">plot_sbc_hist</a></span><span class="op">(</span><span class="va">SBC_LBA_single</span>, bins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-7-1.png" alt="Histogram SBC LBA single" width="700"></p>
<p>Here the gray lines indicate the 2.5, 50 and 97.5% percentile of
where <em>n</em> samples from a uniform distribution are expected to
fall. As we can see most of the bins are are nicely within these bounds
and no clear pattern emerges. However, this visualization very much
depends on bin size, as pointed out by <span class="citation">Talts et
al. (2018)</span>. Therefore EMC also comes with plots that visualize
the difference in the empirical cumulative density function (ecdf) and
the cumulative density function of a uniform distribution.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sbc_ecdf.html">plot_sbc_ecdf</a></span><span class="op">(</span><span class="va">SBC_LBA_single</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-8-1.png" alt="ecdf LBA single" width="700"></p>
<p>In these dinosaur eggs the blue area visualizes the 95% area of
expected cumulative values. As with real eggs, the observed line,
(i.e. the cracks) should obviously lie somewhere on the egg. For an
explanation and guide to interpretation to these plots we recommend the
following article <a href="https://hyunjimoon.github.io/SBC/articles/rank_visualizations.html" class="external-link uri">https://hyunjimoon.github.io/SBC/articles/rank_visualizations.html</a>.
In the remainder of this article we’ll use these plots to visualize SBC
results.</p>
</div>
<div class="section level3">
<h3 id="ddm">DDM<a class="anchor" aria-label="anchor" href="#ddm"></a>
</h3>
<p>Next we test non-hierarchical for the DDM as well. Initial results
actually showed bias in the estimation of non-decision time and
non-decision time variability. Whereas we first based our DDM
implementation on the <em>rtdists</em> package <span class="citation">(Singmann et al. 2022)</span>. The bias led us to
explore alternative packages, which eventually brought us to the
<em>WienR</em> package <span class="citation">(Hartmann and Klauer
2023)</span>. This package not only offers faster likelihood evaluations
but also eliminates the bias observed in the SBC results. Hence as of
CRAN release 2.1.0 we adapted our code to instead use the WienR C++
routines.</p>
<p>For the SBC itself we used the following prior and design settings,
again being mindful of the required transformations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#?DDM</span></span>
<span><span class="va">design_DDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span>factors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subjects<span class="op">=</span><span class="fl">1</span>,S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       Rlevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>,</span>
<span>                       formula <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">v</span><span class="op">~</span><span class="fl">1</span>,<span class="va">a</span><span class="op">~</span><span class="fl">1</span>, <span class="va">t0</span><span class="op">~</span><span class="fl">1</span>, <span class="va">s</span><span class="op">~</span><span class="fl">1</span>, <span class="va">Z</span><span class="op">~</span><span class="fl">1</span>, <span class="va">sv</span><span class="op">~</span><span class="fl">1</span>, <span class="va">SZ</span><span class="op">~</span><span class="fl">1</span>, <span class="va">st0</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       constants<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>s<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       model <span class="op">=</span> <span class="va">DDM</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">prior_DDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="va">design_DDM</span>, type <span class="op">=</span> <span class="st">"single"</span>,</span>
<span>                  pmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">.05</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.05</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  psd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.15</span>, <span class="fl">.1</span>, <span class="fl">.05</span>, <span class="fl">.15</span>, <span class="fl">.15</span>, <span class="fl">.15</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SBC_DDM_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sbc.html">run_sbc</a></span><span class="op">(</span><span class="va">design_DDM</span>, <span class="va">prior_DDM</span>, replicates <span class="op">=</span> <span class="fl">500</span>, trials <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                          fileName <span class="op">=</span> <span class="st">"SBC_data/SBC_DDM_single.RData"</span>, cores_per_chain <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>Next we plot the ECDF difference plot again.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sbc_ecdf.html">plot_sbc_ecdf</a></span><span class="op">(</span><span class="va">SBC_DDM_single</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-11-1.png" alt="ecdf DDM single" width="960"></p>
<p>We see minor biases in <em>a</em> and <em>sv</em>, but nothing too
concerning. To double check, we repeated the analysis, and confirmed
that the bias is not systematic.</p>
</div>
</div>
<div class="section level2">
<h2 id="hierarchical-sbc">Hierarchical SBC<a class="anchor" aria-label="anchor" href="#hierarchical-sbc"></a>
</h2>
<p>Besides being a friendly introduction to doing SBC in <em>EMC2</em>,
this post also serves as a test of unbiased estimation of the four main
classes of EAMs included in <em>EMC2</em>. However, depending on the
research question, running non-hierarchical SBC might suffice as it is
far more computationally efficient.</p>
<p>The approach to running hierarchical SBC is very similar to running
non-hierarchical SBC. However we can now write the model of data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo stretchy="false" form="prefix">|</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y \sim p(y|\alpha)p(\alpha|\theta)p(\theta)</annotation></semantics></math>.
Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(\theta)</annotation></semantics></math>
is the prior on the group-level parameters. The generated data for one
sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">y^{(i)}</annotation></semantics></math>
is still generated from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>,
but with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>α</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\alpha^{(i)}</annotation></semantics></math>
generated from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\theta^{(i)}</annotation></semantics></math>,
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>∼</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta^{(i)} \sim p(\theta)</annotation></semantics></math>.</p>
<div class="section level3">
<h3 id="prior-structure">Prior structure<a class="anchor" aria-label="anchor" href="#prior-structure"></a>
</h3>
<p>Although in the paper we rely on the prior structure defined by <span class="citation">Huang and Wand (2013)</span>, which is also the default
in <em>EMC2</em>, this prior structure has a lot of mass near zero for
the group-level variance parameters (a half<em>-t</em> distribution).
From a Bayesian posterior view these prior structures are attractive
<span class="citation">(Gelman 2006)</span>, since they do not
artificially increase the variance estimates and thus err on the safe
side. However, in SBC data-generation this means we sample many
data-sets with no individual differences. Unfortunately, for numerical
reasons <em>EMC2</em> cannot recover a true zero on group-level
variances. Thus, <em>EMC2</em> will struggle to converge and will
identify some level of individual differences, although they may be very
small. Therefore, the <code>type = "standard"</code> prior structure
results in biased SBC variance estimates. Therefore, in SBC we recommend
using <code>type = "diagonal-gamma"</code>, which as the name suggests
uses gamma distributions for the variance parameters, which have less
mass at zero.</p>
<p>Nevertheless we believe the standard prior is not problematic in real
data, since it will always contain at least some degree of individual
differences (only a true zero cannot be recovered). Therefore it will
remain the default prior in EMC2 as of now, though the type
“diagonal-gamma” is available to the user as well.</p>
</div>
<div class="section level3">
<h3 id="lba-1">LBA<a class="anchor" aria-label="anchor" href="#lba-1"></a>
</h3>
<p>Now we dive into hierarchical SBC for the LBA model. The prior
structure we chose was as follows. Here we have to be extra mindful of
choosing a prior that ensures plausible generated data, since there’s a
double propagation of induced variance through the prior. First through
the prior on the standard deviation of the group-level mean, but also
through the prior on the group-level variance.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_subjects</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="co"># </span></span>
<span><span class="va">matchfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="va">d</span><span class="op">$</span><span class="va">S</span> <span class="op">==</span> <span class="va">d</span><span class="op">$</span><span class="va">lR</span></span>
<span></span>
<span><span class="va">design_LBA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span>factors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subjects<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">n_subjects</span>,S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     Rlevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>,</span>
<span>                     matchfun <span class="op">=</span> <span class="va">matchfun</span>,</span>
<span>                     formula <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">v</span><span class="op">~</span><span class="va">lM</span>,<span class="va">B</span><span class="op">~</span><span class="fl">1</span>, <span class="va">t0</span><span class="op">~</span><span class="fl">1</span>, <span class="va">sv</span><span class="op">~</span><span class="fl">1</span>, <span class="va">A</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                     constants<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>sv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     model <span class="op">=</span> <span class="va">LBA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior_LBA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="va">design_LBA</span>, type <span class="op">=</span> <span class="st">"diagonal-gamma"</span>,</span>
<span>                  mu_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.3</span>, <span class="fl">.7</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  mu_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.05</span>, <span class="fl">.05</span><span class="op">)</span>,</span>
<span>                  shape <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also plot what the implied prior range is of the subject-level
parameters:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">prior_LBA</span>, selection <span class="op">=</span> <span class="st">"alpha"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-13-1.png" alt="Prior for LBA hierarchical model" width="700"></p>
<p>To actually run SBC, we can use the same function as before, now also
specifying how many subjects we want to have in the hierarchical
model</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SBC_LBA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sbc.html">run_sbc</a></span><span class="op">(</span><span class="va">design_LBA</span>, <span class="va">prior_LBA</span>, replicates <span class="op">=</span> <span class="fl">500</span>, trials <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                        n_subjects <span class="op">=</span> <span class="va">n_subjects</span>, fileName <span class="op">=</span> <span class="st">"SBC_data/SBC_LBA.RData"</span>, cores_per_chain <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>We can also plot the results again using the
<code>plot_sbc_ecdf</code> function. It will now generate a set of ECDF
difference plots for the hierarchical variance ranks and the
hierarchical means ranks:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sbc_ecdf.html">plot_sbc_ecdf</a></span><span class="op">(</span><span class="va">SBC_LBA</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-16-1.png" alt="ECDF SBC LBA" width="700"><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-16-2.png" alt="ECDF SBC LBA" width="700"></p>
<p>As we can see good results for the hierarchical SBC and no noticable
bias in the group-level mean or variance parameters.</p>
</div>
<div class="section level3">
<h3 id="ddm-1">DDM<a class="anchor" aria-label="anchor" href="#ddm-1"></a>
</h3>
<p>We also tested hierarchical SBC for the seven parameter DDM. We again
chose priors carefully here to match realistic behavioral data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_subjects</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="va">design_DDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span>factors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subjects<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">n_subjects</span>,S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       Rlevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>,</span>
<span>                       formula <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">v</span><span class="op">~</span><span class="fl">1</span>,<span class="va">a</span><span class="op">~</span><span class="fl">1</span>, <span class="va">t0</span><span class="op">~</span><span class="fl">1</span>, <span class="va">s</span><span class="op">~</span><span class="fl">1</span>, <span class="va">Z</span><span class="op">~</span><span class="fl">1</span>, <span class="va">sv</span><span class="op">~</span><span class="fl">1</span>, <span class="va">SZ</span><span class="op">~</span><span class="fl">1</span>, <span class="va">st0</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       constants<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>s<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       model <span class="op">=</span> <span class="va">DDM</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">prior_DDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="va">design_DDM</span>, type <span class="op">=</span> <span class="st">"diagonal-gamma"</span>,</span>
<span>                  pmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">.05</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.05</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  psd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.15</span>, <span class="fl">.15</span>, <span class="fl">.1</span>, <span class="fl">.05</span>, <span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.15</span><span class="op">)</span>,</span>
<span>                  shape <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In contrast to the other models, we generated 200 (instead of 100)
trials per person per cell, since with 100 trials the model sometimes
did not converge or was very slow to converge. We also only generated
250 data sets due to the large computational costs associated with
running a full hierarchical DDM.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SBC_DDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sbc.html">run_sbc</a></span><span class="op">(</span><span class="va">design_DDM</span>, <span class="va">prior_DDM</span>, replicates <span class="op">=</span> <span class="fl">250</span>, trials <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                        n_subjects <span class="op">=</span> <span class="va">n_subjects</span>, fileName <span class="op">=</span> <span class="st">"SBC_data/SBC_DDM.RData"</span>, cores_per_chain <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>The group-level means look unbiased, the group-level variance of the
between trial variability parameters is overestimated a bit. We note
that the effective sample size for these parameters is also very small
(although minimum a 100), which can bias the results <span class="citation">(Talts et al. 2018)</span>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sbc_ecdf.html">plot_sbc_ecdf</a></span><span class="op">(</span><span class="va">SBC_DDM</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-20-1.png" alt="ECDF SBC DDM" width="700"><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-20-2.png" alt="ECDF SBC DDM" width="700"></p>
</div>
<div class="section level3">
<h3 id="rdm">RDM<a class="anchor" aria-label="anchor" href="#rdm"></a>
</h3>
<p>For completeness and as a proof of correct implementation we also
test hierarchical SBC for the RDM with the following model definition
and prior structure.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_subjects</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="va">matchfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="va">d</span><span class="op">$</span><span class="va">S</span> <span class="op">==</span> <span class="va">d</span><span class="op">$</span><span class="va">lR</span></span>
<span></span>
<span></span>
<span><span class="va">design_RDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span>factors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subjects<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">n_subjects</span>,S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     Rlevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>,</span>
<span>                     matchfun <span class="op">=</span> <span class="va">matchfun</span>,</span>
<span>                     formula <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">v</span><span class="op">~</span><span class="va">lM</span>,<span class="va">B</span><span class="op">~</span><span class="fl">1</span>, <span class="va">t0</span><span class="op">~</span><span class="fl">1</span>, <span class="va">A</span><span class="op">~</span><span class="fl">1</span>, <span class="va">s</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                     constants<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>s<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     model <span class="op">=</span> <span class="va">RDM</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior_RDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="va">design_RDM</span>, type <span class="op">=</span> <span class="st">"diagonal-gamma"</span>,</span>
<span>                  mu_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.4</span>, <span class="fl">.3</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  mu_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.05</span>, <span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.05</span>, <span class="fl">.05</span><span class="op">)</span>,</span>
<span>                  shape <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SBC_RDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sbc.html">run_sbc</a></span><span class="op">(</span><span class="va">design_RDM</span>, <span class="va">prior_RDM</span>, replicates <span class="op">=</span> <span class="fl">500</span>, trials <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                        n_subjects <span class="op">=</span> <span class="va">n_subjects</span>, fileName <span class="op">=</span> <span class="st">"SBC_RDM.RData"</span>, cores_per_chain <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>We again note that SBC shows no bias in the hierarchical RDM
model:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sbc_ecdf.html">plot_sbc_ecdf</a></span><span class="op">(</span><span class="va">SBC_RDM</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-23-1.png" alt="ECDF SBC RDM" width="700"><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-23-2.png" alt="ECDF SBC RDM" width="700"></p>
</div>
<div class="section level3">
<h3 id="lnr">LNR<a class="anchor" aria-label="anchor" href="#lnr"></a>
</h3>
<p>Lastly, we run hierarchical SBC for the LNR with the following
specification</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_subjects</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="va">matchfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="va">d</span><span class="op">$</span><span class="va">S</span> <span class="op">==</span> <span class="va">d</span><span class="op">$</span><span class="va">lR</span></span>
<span></span>
<span><span class="va">design_LNR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span>factors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subjects<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">n_subjects</span>,S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     Rlevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>,</span>
<span>                     matchfun <span class="op">=</span> <span class="va">matchfun</span>,</span>
<span>                     formula <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span><span class="op">~</span><span class="va">lM</span>,<span class="va">s</span><span class="op">~</span><span class="fl">1</span>, <span class="va">t0</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                     model <span class="op">=</span> <span class="va">LNR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior_LNR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="va">design_LNR</span>, type <span class="op">=</span> <span class="st">"diagonal-gamma"</span>,</span>
<span>                  mu_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.7</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  mu_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.1</span>, <span class="fl">.05</span><span class="op">)</span>,</span>
<span>                  shape <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SBC_LNR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_sbc.html">run_sbc</a></span><span class="op">(</span><span class="va">design_LNR</span>, <span class="va">prior_LNR</span>, replicates <span class="op">=</span> <span class="fl">500</span>, trials <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                        n_subjects <span class="op">=</span> <span class="va">n_subjects</span>, fileName <span class="op">=</span> <span class="st">"SBC_LNR.RData"</span>, cores_per_chain <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>For the LNR hierarchical SBC also shows no considerable bias:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sbc_ecdf.html">plot_sbc_ecdf</a></span><span class="op">(</span><span class="va">SBC_LNR</span>, layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-26-1.png" alt="ECDF SBC RDM" width="700"><img src="Simulation-based-Calibration_files/figure-html/unnamed-chunk-26-2.png" alt="ECDF SBC RDM" width="700"></p>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="section"></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Gelman2006Sep" class="csl-entry">
Gelman, Andrew. 2006. <span>“<span class="nocase">Prior distributions
for variance parameters in hierarchical models (comment on article by
Browne and Draper)</span>.”</span> <em>Bayesian Analysis</em> 1 (3):
515–34. <a href="https://doi.org/10.1214/06-BA117A" class="external-link">https://doi.org/10.1214/06-BA117A</a>.
</div>
<div id="ref-Hartmann2023" class="csl-entry">
Hartmann, Raphael, and Karl C. Klauer. 2023. <em>WienR: Derivatives of
the First-Passage Time Density and Cumulative Distribution Function, and
Random Sampling from the (Truncated) First-Passage Time
Distribution</em>. <a href="https://CRAN.R-project.org/package=WienR" class="external-link">https://CRAN.R-project.org/package=WienR</a>.
</div>
<div id="ref-Huang2013Jun" class="csl-entry">
Huang, Alan, and M. P. Wand. 2013. <span>“<span class="nocase">Simple
Marginally Noninformative Prior Distributions for Covariance
Matrices</span>.”</span> <em>Bayesian Analysis</em> 8 (2): 439–52. <a href="https://doi.org/10.1214/13-BA815" class="external-link">https://doi.org/10.1214/13-BA815</a>.
</div>
<div id="ref-Sigmann2022" class="csl-entry">
Singmann, Henrik, Scott Brown, Matthew Gretton, and Andrew Heathcote.
2022. <em>Rtdists: Response Time Distributions</em>. <a href="https://CRAN.R-project.org/package=rtdists" class="external-link">https://CRAN.R-project.org/package=rtdists</a>.
</div>
<div id="ref-talts2018validating" class="csl-entry">
Talts, Sean, Michael Betancourt, Daniel Simpson, Aki Vehtari, and Andrew
Gelman. 2018. <span>“Validating Bayesian Inference Algorithms with
Simulation-Based Calibration.”</span> <em>arXiv Preprint
arXiv:1804.06788</em>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niek Stevenson, Michelle Donzallaz, Andrew Heathcote.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
