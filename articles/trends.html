<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Trends • EMC2</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Trends">
<meta name="description" content="A guide to trends in EMC2">
<meta property="og:description" content="A guide to trends in EMC2">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EMC2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Simulation-based-Calibration.html">Simulation-based Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/trends.html">Trends</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ampl-psych/EMC2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Trends</h1>
                        <h4 data-toc-skip class="author">Niek Stevenson
&amp; Steven Miletić</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ampl-psych/EMC2/blob/main/vignettes/trends.Rmd" class="external-link"><code>vignettes/trends.Rmd</code></a></small>
      <div class="d-none name"><code>trends.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Trends in EMC2 allow you to model how parameters change as a function
of covariates or other parameters. They provide a flexible way to
capture systematic changes in model parameters across conditions or over
time. This vignette shows:</p>
<ul>
<li>How to specify trends with kernels and bases</li>
<li>How to attach trends to models via <code><a href="../reference/design.html">design()</a></code> and run via
<code><a href="../reference/make_emc.html">make_emc()</a></code> and <code><a href="../reference/fit.html">fit()</a></code>
</li>
<li>How to control when a trend is applied (premap, pretransform,
posttransform)</li>
<li>How to share trend parameters</li>
<li>How to use other parameters as trend inputs
(<code>par_input</code>)</li>
<li>How to register and use a custom C++ trend kernel</li>
</ul>
</div>
<div class="section level2">
<h2 id="trend-composition">Trend Composition<a class="anchor" aria-label="anchor" href="#trend-composition"></a>
</h2>
<p>A trend is composed of a kernel and a base. The kernel maps inputs to
a per‑trial value <code>k</code>; the base then maps <code>k</code> into
the parameter scale. Use <code><a href="../reference/trend_help.html">trend_help()</a></code> to list kernels and
bases. The timing of when a trend is applied is controlled by
<code>phase</code> (see <a href="#phases">Phases</a> below).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trend_help.html">trend_help</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Available kernels:</span></span>
<span><span class="co">##   custom: Custom C++ kernel: provided via register_trend().</span></span>
<span><span class="co">##   lin_decr: Decreasing linear kernel: k = -c</span></span>
<span><span class="co">##   lin_incr: Increasing linear kernel: k = c</span></span>
<span><span class="co">##   exp_decr: Decreasing exponential kernel: k = exp(-d_ed * c)</span></span>
<span><span class="co">##   exp_incr: Increasing exponential kernel: k = 1 - exp(-d_ei * c)</span></span>
<span><span class="co">##   pow_decr: Decreasing power kernel: k = (1 + c)^(-d_pd)</span></span>
<span><span class="co">##   pow_incr: Increasing power kernel: k = 1 - (1 + c)^(-d_pi)</span></span>
<span><span class="co">##   poly2: Quadratic polynomial: k = d1 * c + d2 * c^2</span></span>
<span><span class="co">##   poly3: Cubic polynomial: k = d1 * c + d2 * c^2 + d3 * c^3</span></span>
<span><span class="co">##   poly4: Quartic polynomial: k = d1 * c + d2 * c^2 + d3 * c^3 + d4 * c^4</span></span>
<span><span class="co">##   delta: Standard delta rule kernel: k = q[i].</span></span>
<span><span class="co">##          Updates q[i] = q[i-1] + alpha * (c[i-1] - q[i-1]).</span></span>
<span><span class="co">##          Parameters: q0 (initial value), alpha (learning rate).</span></span>
<span><span class="co">##   delta2kernel: Dual kernel delta rule: k = q[i].</span></span>
<span><span class="co">##           Combines fast and slow learning rates</span></span>
<span><span class="co">##           and switches between them based on dSwitch.</span></span>
<span><span class="co">##           Parameters: q0 (initial value), alphaFast (fast learning rate),</span></span>
<span><span class="co">##           propSlow (alphaSlow = propSlow * alphaFast), dSwitch (switch threshold).</span></span>
<span><span class="co">##   delta2lr: Dual learning rate delta rule: k = q[i].</span></span>
<span><span class="co">##           Like the standard delta rule, but with separate</span></span>
<span><span class="co">##           learning rates for positive and negative prediction errors.</span></span>
<span><span class="co">##           Parameters: q0 (initial value), alphaPos (learning rate for positive PEs),</span></span>
<span><span class="co">##           alphaNeg (learning rate for negative PEs).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Available base types:</span></span>
<span><span class="co">##   lin: Linear base: parameter + w * k</span></span>
<span><span class="co">##   exp_lin: Exponential linear base: exp(parameter) + exp(w) * k</span></span>
<span><span class="co">##   centered: Centered mapping: parameter + w*(k - 0.5)</span></span>
<span><span class="co">##   add: Additive base: parameter + k</span></span>
<span><span class="co">##   identity: Identity base: k</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Phase options:</span></span>
<span><span class="co">##   premap: Trend is applied before parameter mapping. This means the trend parameters</span></span>
<span><span class="co">##           are mapped first, then used to transform cognitive model parameters before </span></span>
<span><span class="co">##           their mapping.</span></span>
<span><span class="co">##   pretransform: Trend is applied after parameter mapping but before transformations.</span></span>
<span><span class="co">##                 Cognitive model parameters are mapped first, then trend is applied, </span></span>
<span><span class="co">##                 followed by transformations.</span></span>
<span><span class="co">##   posttransform: Trend is applied after both mapping and transformations.</span></span>
<span><span class="co">##                  Cognitive model parameters are mapped and transformed first, </span></span>
<span><span class="co">##                  then trend is applied.</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="quick-start-from-trend-to-model">Quick Start: From trend to model<a class="anchor" aria-label="anchor" href="#quick-start-from-trend-to-model"></a>
</h2>
<p>Below is a minimal pipeline using the data in
<code>samples_LNR</code> (three subjects from Forstmann 2008) to
demonstrate where a trend fits in. We create a trend, attach it in the
design, and show how it plugs into <code><a href="../reference/make_emc.html">make_emc()</a></code> and
<code><a href="../reference/fit.html">fit()</a></code> (calls not evaluated here).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example trend: log-mean increases linearly with trial</span></span>
<span><span class="va">trend_quick</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"m"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="st">"lin_incr"</span>,</span>
<span>  bases     <span class="op">=</span> <span class="st">"lin"</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"pretransform"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">samples_LNR</span><span class="op">)</span></span>
<span><span class="co"># This does not take subject id into account</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">trial_nr</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">covariate1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">covariate2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Build a design with the trend</span></span>
<span><span class="va">design_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span></span>
<span>  data     <span class="op">=</span> <span class="va">data</span>,</span>
<span>  trend    <span class="op">=</span> <span class="va">trend_quick</span>,</span>
<span>  matchfun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="va">d</span><span class="op">$</span><span class="va">S</span> <span class="op">==</span> <span class="va">d</span><span class="op">$</span><span class="va">lR</span>,</span>
<span>  formula  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span> <span class="op">~</span> <span class="va">lM</span>, <span class="va">s</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">t0</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  model    <span class="op">=</span> <span class="va">LNR</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Intercept formula added for trend_pars: m.w</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Sampled Parameters: </span></span>
<span><span class="co">## [1] "m"     "m_lMd" "s"     "t0"    "m.w"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Design Matrices: </span></span>
<span><span class="co">## $m</span></span>
<span><span class="co">##     lM m m_lMd</span></span>
<span><span class="co">##   TRUE 1   0.5</span></span>
<span><span class="co">##  FALSE 1  -0.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s</span></span>
<span><span class="co">##  s</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $t0</span></span>
<span><span class="co">##  t0</span></span>
<span><span class="co">##   1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.w</span></span>
<span><span class="co">##  m.w</span></span>
<span><span class="co">##    1</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How you would run (not executed here)</span></span>
<span><span class="co"># emc &lt;- make_emc(data, design_trend, type = "single")</span></span>
<span><span class="co"># fit &lt;- fit(emc)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="defining-a-trend">Defining a Trend<a class="anchor" aria-label="anchor" href="#defining-a-trend"></a>
</h2>
<p>A trend is created using the <code><a href="../reference/make_trend.html">make_trend()</a></code> function with
the following main arguments:</p>
<ul>
<li>
<code>par_names</code>: Which cognitive model parameters to apply
the trend to</li>
<li>
<code>cov_names</code>: Which covariates to use for each trend</li>
<li>
<code>kernels</code>: Which kernel function to use for each
trend</li>
<li>
<code>bases</code>: Optional base functions for each trend</li>
</ul>
<p>Let’s take the following example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_lin_decr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"lin_incr"</span>,</span>
<span>  bases <span class="op">=</span> <span class="st">"lin"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This trend applies a linear increasing kernel to <code>v</code> using
<code>trial</code> as input. This captures a hypothesis that the drift
rate (<code>v</code>) increases over trials. To see how the trend is
formulated use <code><a href="../reference/trend_help.html">trend_help()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trend_help.html">trend_help</a></span><span class="op">(</span>kernel <span class="op">=</span> <span class="st">"lin_incr"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Description: </span></span>
<span><span class="co">## Increasing linear kernel: k = c </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Available bases, first is the default: </span></span>
<span><span class="co">## lin, exp_lin, centered </span></span>
<span><span class="co">## </span></span></code></pre>
<p>The function tells us how the kernel maps the covariate to the kernel
<code>k</code>. In this case the kernel <code>k</code> is just the
covariate <code>c</code>. The kernel is then used in the base function.
The <code><a href="../reference/trend_help.html">trend_help()</a></code> function also shows us the available base
functions for this kernel. In this case we will use the <code>lin</code>
base function. To see how this base function is formulated we can use
the <code><a href="../reference/trend_help.html">trend_help()</a></code> function again.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trend_help.html">trend_help</a></span><span class="op">(</span>base <span class="op">=</span> <span class="st">"lin"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Description: </span></span>
<span><span class="co">## Linear base: parameter + w * k </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## Default transformations: </span></span>
<span><span class="co">## list(w = "identity")</span></span>
<span><span class="co">## </span></span></code></pre>
<p>Together these specify how the trend affects the model parameter.
With base <code>lin</code>, the mapping is
<code>v &lt;- v + B0 * k</code>, where <code>B0</code> is the base
parameter and <code>k</code> comes from the kernel (here
<code>k = c</code>, the covariate). Although this separation may seem
verbose for simple cases, it makes more complex specifications clear and
composable.</p>
<p>EMC2 automatically creates parameter names for the trend, which can
be accessed using the <code><a href="../reference/get_trend_pnames.html">get_trend_pnames()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_trend_pnames.html">get_trend_pnames</a></span><span class="op">(</span><span class="va">trend_lin_decr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "v.w"</span></span></code></pre>
<p>These parameter names are now included in the parameter types of the
model.</p>
</div>
<div class="section level2">
<h2 id="available-kernel-types">Available Kernel Types<a class="anchor" aria-label="anchor" href="#available-kernel-types"></a>
</h2>
<p>EMC2 provides several kernel functions for modeling how cognitive
model parameters change as a function of covariates.</p>
<div class="section level3">
<h3 id="linear-trends">Linear Trends<a class="anchor" aria-label="anchor" href="#linear-trends"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linear decreasing trend</span></span>
<span><span class="va">trend_lin_decr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"lin_decr"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear increasing trend</span></span>
<span><span class="va">trend_lin_incr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"lin_incr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Linear trends model straight‑line relationships between parameters
and covariates. They are often a good starting point. You could encode
linear effects via <code><a href="../reference/design.html">design()</a></code> covariates, but bundling them
into a trend enables shared control via bases and phases and keeps
specifications local to parameters.</p>
</div>
<div class="section level3">
<h3 id="exponential-trends">Exponential Trends<a class="anchor" aria-label="anchor" href="#exponential-trends"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Exponential decreasing trend</span></span>
<span><span class="va">trend_exp_decr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"exp_decr"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exponential increasing trend</span></span>
<span><span class="va">trend_exp_incr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"exp_incr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Exponential trends are useful for rapid initial changes that level
off. <code>exp_decr</code> captures decay; <code>exp_incr</code>
captures learning.</p>
</div>
<div class="section level3">
<h3 id="power-trends">Power Trends<a class="anchor" aria-label="anchor" href="#power-trends"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Power decreasing trend</span></span>
<span><span class="va">trend_pow_decr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"pow_decr"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Power increasing trend</span></span>
<span><span class="va">trend_pow_incr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"pow_incr"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Power trends provide another way to model non‑linear relationships,
often used for practice effects.</p>
</div>
<div class="section level3">
<h3 id="polynomial-trends">Polynomial Trends<a class="anchor" aria-label="anchor" href="#polynomial-trends"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quadratic trend</span></span>
<span><span class="va">trend_poly2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"poly2"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cubic trend</span></span>
<span><span class="va">trend_poly3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"poly3"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quartic trend</span></span>
<span><span class="va">trend_poly4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"poly4"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Polynomial trends allow for complex relationships, including multiple
turning points. Use higher orders cautiously to avoid overfitting.</p>
</div>
<div class="section level3">
<h3 id="learning-rule-trends">Learning Rule Trends<a class="anchor" aria-label="anchor" href="#learning-rule-trends"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standard delta learning rule</span></span>
<span><span class="va">trend_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"delta"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dual learning rate delta rule</span></span>
<span><span class="va">trend_delta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"delta2kernel"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Delta rules are useful for learning processes. The standard delta
rule updates based on prediction error. The dual‑rate rule uses fast and
slow learning rates, switching between them based on discrepancies.</p>
<p>Each kernel has supported bases. You can leave bases to defaults or
set them explicitly. Changing bases can reflect different
interpretations of how <code>k</code> enters the parameter:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_exp_incr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="st">"exp_incr"</span>,</span>
<span>  bases <span class="op">=</span>  <span class="st">"exp_lin"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For example with base <code>lin</code>:
<code>v &lt;- v + B0 * k</code>. With base <code>exp_lin</code>:
<code>v &lt;- exp(v) + exp(B0) * k</code>. The latter can be useful when
the parameter operates on a multiplicative or positively constrained
scale.</p>
</div>
</div>
<div class="section level2">
<h2 id="multiple-trends">Multiple Trends<a class="anchor" aria-label="anchor" href="#multiple-trends"></a>
</h2>
<p>Some models have multiple parameters that are affected by the same
covariate. In this case, we can specify multiple trends for the same
covariate. Note that with the kernels argument, we can specify different
kernels for each parameter.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Applying different trends to multiple parameters</span></span>
<span><span class="va">trend_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"v"</span>, <span class="st">"t0"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trial_nr"</span><span class="op">)</span>,</span>
<span>  kernels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_incr"</span>, <span class="st">"poly2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, different parameters may be affected by different
covariates:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specifying different covariates for each trend</span></span>
<span><span class="va">trend_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"v"</span>, <span class="st">"t0"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trial_nr"</span>, <span class="st">"covariate1"</span><span class="op">)</span>,</span>
<span>  kernels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_incr"</span>, <span class="st">"poly2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Lastly, a single parameter may be affected by multiple
covariates:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specifying multiple covariates for a trend</span></span>
<span><span class="va">trend_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"v"</span>, <span class="st">"t0"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trial"</span>, <span class="st">"covariate1"</span><span class="op">)</span>, <span class="st">"covariate1"</span><span class="op">)</span>,</span>
<span>  kernels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_incr"</span>, <span class="st">"poly2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="sharing-parameters">Sharing Parameters<a class="anchor" aria-label="anchor" href="#sharing-parameters"></a>
</h3>
<p>Sometimes multiple trend entries should use the same parameter(s).
For example, share a base parameter across different target
parameters:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sharing parameters between trends</span></span>
<span><span class="va">trend_shared</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"v"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_incr"</span>, <span class="st">"exp_incr"</span><span class="op">)</span>,</span>
<span>  shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"v.B0"</span>, <span class="st">"a.B0"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This shares <code>B0</code> between <code>v</code> and <code>a</code>
trends. Instead of two <code>B0</code> parameters, there is one named
<code>intercept</code>. Use <code><a href="../reference/get_trend_pnames.html">get_trend_pnames()</a></code> to inspect
the generated names:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_trend_pnames.html">get_trend_pnames</a></span><span class="op">(</span><span class="va">trend_shared</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "v.w"       "v.d_ei"    "a.w"       "a.d_ei"    "intercept"</span></span></code></pre>
<p>We can also specify multiple shared parameters, for example
<code>shared = list(intercept = list("v.B0", "a.B0"), slope = list("v.d_ei", "a.d_ei"))</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="phases">Phases<a class="anchor" aria-label="anchor" href="#phases"></a>
</h2>
<p>Control when a trend is applied via the <code>phase</code>
argument:</p>
<ul>
<li>
<code>premap</code>: before parameter mapping (i.e., modifies raw
parameter vectors)</li>
<li>
<code>pretransform</code>: after mapping but before transforms</li>
<li>
<code>posttransform</code>: after transforms</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pre-mapping trend</span></span>
<span><span class="va">trend_premap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="st">"exp_incr"</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"premap"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pre-transform trend</span></span>
<span><span class="va">trend_pretrans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="st">"exp_incr"</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"pretransform"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Post-transform trend</span></span>
<span><span class="va">trend_posttrans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"v"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="st">"exp_incr"</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"posttransform"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Phases change how trends interact with mapping and transformations.
For example, a <code>premap</code> trend can feed transformed outputs
into parameter mapping, while <code>posttransform</code> trends act on
the final, transformed parameter scale.</p>
</div>
<div class="section level2">
<h2 id="parameter-inputs-par_input">Parameter Inputs (<code>par_input</code>)<a class="anchor" aria-label="anchor" href="#parameter-inputs-par_input"></a>
</h2>
<p>Trends can also depend on other parameters via
<code>par_input</code>. For example, use <code>t0</code> as an input to
a trend on <code>m</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_par_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"m"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="st">"lin_incr"</span>,</span>
<span>  par_input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"t0"</span><span class="op">)</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"pretransform"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This example mirrors the tests: the input matrix provided to the
kernel will contain the covariate columns (none here) followed by the
<code>par_input</code> columns (here <code>t0</code>).</p>
<div class="section level3">
<h3 id="apply-a-trend-only-at-a-factor-level-at">Apply a trend only at a factor level (<code>at</code>)<a class="anchor" aria-label="anchor" href="#apply-a-trend-only-at-a-factor-level-at"></a>
</h3>
<p>Use <code>at</code> to apply a trend only for rows at a specific
factor level (e.g., first level of <code>lR</code>) and expand its
contribution to the other levels within the same subject.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_at</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"covariate1"</span><span class="op">)</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_incr"</span><span class="op">)</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"pretransform"</span>,</span>
<span>  at        <span class="op">=</span> <span class="st">"lR"</span>   <span class="co"># apply only at first level of lR, then expand within subject</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This is useful when a covariate (or its effect) should only be
applied to a specific level of a factor (most commonly lR), so that if
the design is replicated across levels of the factor, the trend is only
applied to the first level of the factor.</p>
</div>
<div class="section level3">
<h3 id="multiple-contributions-to-the-same-parameter">Multiple contributions to the same parameter<a class="anchor" aria-label="anchor" href="#multiple-contributions-to-the-same-parameter"></a>
</h3>
<p>You can place multiple trend entries on the same target parameter.
Their kernel outputs will be summed (after any optional per‑column map
weights) before the base is applied.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_multi_same_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"m"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"covariate1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"covariate2"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># second entry could also use par_input</span></span>
<span>  kernels   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_incr"</span>, <span class="st">"delta"</span><span class="op">)</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"pretransform"</span>,</span>
<span>  at        <span class="op">=</span> <span class="st">"lR"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In the internal input matrix, covariate columns come first, followed
by any <code>par_input</code> columns. The per‑column kernel
contributions are summed row‑wise.</p>
</div>
<div class="section level3">
<h3 id="phase-per-trend-entry">Phase per trend entry<a class="anchor" aria-label="anchor" href="#phase-per-trend-entry"></a>
</h3>
<p>Instead of one <code>phase</code> for all entries, you can provide a
vector matching <code>par_names</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_phases</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"s"</span>, <span class="st">"t0"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"covariate1"</span>, <span class="st">"covariate1"</span>, <span class="st">"covariate2"</span><span class="op">)</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lin_incr"</span>, <span class="st">"exp_decr"</span>, <span class="st">"pow_incr"</span><span class="op">)</span>,</span>
<span>  phase     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"premap"</span>, <span class="st">"pretransform"</span>, <span class="st">"posttransform"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Non‑<code>premap</code> targets must be actual model parameter names
(checked in the code), since these act after mapping.</p>
</div>
<div class="section level3">
<h3 id="sharing-kernel-parameters-not-only-base-weights">Sharing kernel parameters (not only base weights)<a class="anchor" aria-label="anchor" href="#sharing-kernel-parameters-not-only-base-weights"></a>
</h3>
<p>Sharing can also target kernel parameters, not just the base weight.
For example, share <code>d1</code> across two parameters:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_shared_kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"covariate1"</span>, <span class="st">"covariate2"</span><span class="op">)</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poly3"</span>, <span class="st">"poly4"</span><span class="op">)</span>,</span>
<span>  shared    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shrd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"m.d1"</span>, <span class="st">"s.d1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After sharing, <code><a href="../reference/get_trend_pnames.html">get_trend_pnames()</a></code> will include the
shared name once (here <code>shrd</code>) and remove duplicates.</p>
</div>
<div class="section level3">
<h3 id="missing-input-values-na-handling">Missing input values (NA handling)<a class="anchor" aria-label="anchor" href="#missing-input-values-na-handling"></a>
</h3>
<p>Trend kernels ignore rows where any input used by the kernel is
<code>NA</code>. For those rows, the kernel contributes zero. This
applies to both built‑in and custom kernels. In effect:</p>
<ul>
<li>Built‑in kernels evaluate only on “good” rows and expand results
back; NA rows contribute 0.</li>
<li>Custom kernels receive only the subset of non‑NA rows; any
<code>NA</code> in their outputs is coerced to 0 before being expanded
back.</li>
</ul>
<p>This behavior makes trends robust when covariates are intermittently
missing (as exercised in tests that set some covariate entries to
<code>NA</code>).</p>
</div>
<div class="section level3">
<h3 id="trialwise-evaluation-and-conditional-covariates">Trial‑wise evaluation and conditional covariates<a class="anchor" aria-label="anchor" href="#trialwise-evaluation-and-conditional-covariates"></a>
</h3>
<ul>
<li>Delta‑rule kernels (<code>delta</code>, <code>delta2</code>) are
sequential by construction; they update across trials within a
subject.</li>
<li>Using behavioral covariates (e.g., <code>rt</code>, response
<code>R</code>, or outputs of functions in the design) can force a
trial‑wise evaluation path so that data generation is not conditional on
the observed data, but rather on the simulated outcomes.</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example delta trend, capturing trial-wise dynamics</span></span>
<span><span class="va">trend_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="st">"m"</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="st">"delta"</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"pretransform"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span></span>
<span>  factors    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subjects <span class="op">=</span> <span class="fl">1</span>, S <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  Rlevels    <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>  covariates <span class="op">=</span> <span class="st">"trial_nr"</span>,</span>
<span>  matchfun   <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="va">d</span><span class="op">$</span><span class="va">S</span> <span class="op">==</span> <span class="va">d</span><span class="op">$</span><span class="va">lR</span>,</span>
<span>  trend      <span class="op">=</span> <span class="va">trend_delta</span>,</span>
<span>  formula    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span> <span class="op">~</span> <span class="va">lM</span>, <span class="va">s</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">t0</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  contrasts  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  model      <span class="op">=</span> <span class="va">LNR</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Intercept formula added for trend_pars: m.w, m.q0, m.alpha</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Sampled Parameters: </span></span>
<span><span class="co">## [1] "m"       "m_lMd"   "s"       "t0"      "m.w"     "m.q0"    "m.alpha"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Design Matrices: </span></span>
<span><span class="co">## $m</span></span>
<span><span class="co">##     lM m m_lMd</span></span>
<span><span class="co">##   TRUE 1   0.5</span></span>
<span><span class="co">##  FALSE 1  -0.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s</span></span>
<span><span class="co">##  s</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $t0</span></span>
<span><span class="co">##  t0</span></span>
<span><span class="co">##   1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.w</span></span>
<span><span class="co">##  m.w</span></span>
<span><span class="co">##    1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.q0</span></span>
<span><span class="co">##  m.q0</span></span>
<span><span class="co">##     1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.alpha</span></span>
<span><span class="co">##  m.alpha</span></span>
<span><span class="co">##        1</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve trial-wise parameters alongside generated data</span></span>
<span><span class="co"># (not executed here)</span></span>
<span><span class="co"># res &lt;- make_data(p_vector, design_delta, n_trials = 10,</span></span>
<span><span class="co">#                  conditional_on_data = FALSE,</span></span>
<span><span class="co">#                  return_trialwise_parameters = TRUE)</span></span>
<span><span class="co"># str(attr(res, "trialwise_parameters"))</span></span></code></pre></div>
<p>Column names in the returned trial‑wise matrix are formed as
<code>parameter_inputName</code>, where <code>inputName</code> comes
from <code>cov_names</code> followed by any <code>par_input</code>
names.</p>
</div>
<div class="section level3">
<h3 id="vary-trend-parameters-via-the-design-formula">Vary trend parameters via the design formula<a class="anchor" aria-label="anchor" href="#vary-trend-parameters-via-the-design-formula"></a>
</h3>
<p>Trend parameters (base and kernel parameters) can vary by
experimental factors using the <code>formula</code> argument of
<code><a href="../reference/design.html">design()</a></code>. Use <code>get_trend_pnames(trend)</code> to get
the full names to place on the left-hand side of a formula. Names
follow:</p>
<ul>
<li>Base parameter: <code>&lt;targetParam&gt;.w</code> (for bases like
<code>lin</code>, <code>exp_lin</code>, <code>centered</code>)</li>
<li>Kernel parameters:
<code>&lt;targetParam&gt;.&lt;default_par_name&gt;</code> (e.g.,
<code>d1</code>, <code>d2</code>, … for <code>poly*</code>;
<code>q0</code>, <code>alpha</code> for <code>delta</code>)</li>
</ul>
<p>Premap example: vary a kernel parameter (<code>d1</code>) by
<code>lR</code></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_premap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"lMd"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"covariate1"</span>, <span class="st">"covariate2"</span><span class="op">)</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_incr"</span>, <span class="st">"poly2"</span><span class="op">)</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"premap"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_premap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span></span>
<span>  data     <span class="op">=</span> <span class="va">data</span>,                   </span>
<span>  trend    <span class="op">=</span> <span class="va">trend_premap</span>,</span>
<span>  formula  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">s</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">t0</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">lMd.d1</span> <span class="op">~</span> <span class="va">lR</span><span class="op">)</span>,</span>
<span>  model    <span class="op">=</span> <span class="va">LNR</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Intercept formula added for trend_pars: m.w, m.d_ei, lMd.d2</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Sampled Parameters: </span></span>
<span><span class="co">## [1] "m"              "s"              "t0"             "lMd.d1"        </span></span>
<span><span class="co">## [5] "lMd.d1_lRright" "m.w"            "m.d_ei"         "lMd.d2"        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Design Matrices: </span></span>
<span><span class="co">## $m</span></span>
<span><span class="co">##  m</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s</span></span>
<span><span class="co">##  s</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $t0</span></span>
<span><span class="co">##  t0</span></span>
<span><span class="co">##   1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $lMd.d1</span></span>
<span><span class="co">##     lR lMd.d1 lMd.d1_lRright</span></span>
<span><span class="co">##   left      1              0</span></span>
<span><span class="co">##  right      1              1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.w</span></span>
<span><span class="co">##  m.w</span></span>
<span><span class="co">##    1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.d_ei</span></span>
<span><span class="co">##  m.d_ei</span></span>
<span><span class="co">##       1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $lMd.d2</span></span>
<span><span class="co">##  lMd.d2</span></span>
<span><span class="co">##       1</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mapped_pars(design_premap)  # inspect mapped parameter structure</span></span></code></pre></div>
<p>Pretransform example: vary the base weight (<code>w</code>) for
<code>s</code> by <code>lR</code></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_pretrans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"covariate1"</span>, <span class="st">"covariate2"</span><span class="op">)</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"delta"</span>, <span class="st">"exp_decr"</span><span class="op">)</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"pretransform"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_pretrans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span></span>
<span>  data     <span class="op">=</span> <span class="va">data</span>,</span>
<span>  trend    <span class="op">=</span> <span class="va">trend_pretrans</span>,</span>
<span>  formula  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">s</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">t0</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">s.w</span> <span class="op">~</span> <span class="va">lR</span><span class="op">)</span>,</span>
<span>  model    <span class="op">=</span> <span class="va">LNR</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Intercept formula added for trend_pars: m.w, m.q0, m.alpha, s.d_ed</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Sampled Parameters: </span></span>
<span><span class="co">## [1] "m"           "s"           "t0"          "s.w"         "s.w_lRright"</span></span>
<span><span class="co">## [6] "m.w"         "m.q0"        "m.alpha"     "s.d_ed"     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Design Matrices: </span></span>
<span><span class="co">## $m</span></span>
<span><span class="co">##  m</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s</span></span>
<span><span class="co">##  s</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $t0</span></span>
<span><span class="co">##  t0</span></span>
<span><span class="co">##   1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s.w</span></span>
<span><span class="co">##     lR s.w s.w_lRright</span></span>
<span><span class="co">##   left   1           0</span></span>
<span><span class="co">##  right   1           1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.w</span></span>
<span><span class="co">##  m.w</span></span>
<span><span class="co">##    1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.q0</span></span>
<span><span class="co">##  m.q0</span></span>
<span><span class="co">##     1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.alpha</span></span>
<span><span class="co">##  m.alpha</span></span>
<span><span class="co">##        1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s.d_ed</span></span>
<span><span class="co">##  s.d_ed</span></span>
<span><span class="co">##       1</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mapped_pars(design_pretrans)</span></span></code></pre></div>
<p>Posttransform example: again vary <code>s.w</code> by
<code>lR</code></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_posttrans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"covariate1"</span>, <span class="st">"covariate2"</span><span class="op">)</span>,</span>
<span>  kernels   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pow_decr"</span>, <span class="st">"pow_incr"</span><span class="op">)</span>,</span>
<span>  phase     <span class="op">=</span> <span class="st">"posttransform"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_posttrans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span></span>
<span>  data     <span class="op">=</span> <span class="va">data</span>,</span>
<span>  trend    <span class="op">=</span> <span class="va">trend_posttrans</span>,</span>
<span>  formula  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">s</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">t0</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">s.w</span> <span class="op">~</span> <span class="va">lR</span><span class="op">)</span>,</span>
<span>  model    <span class="op">=</span> <span class="va">LNR</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Intercept formula added for trend_pars: m.w, m.d_pd, s.d_pi</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Sampled Parameters: </span></span>
<span><span class="co">## [1] "m"           "s"           "t0"          "s.w"         "s.w_lRright"</span></span>
<span><span class="co">## [6] "m.w"         "m.d_pd"      "s.d_pi"     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Design Matrices: </span></span>
<span><span class="co">## $m</span></span>
<span><span class="co">##  m</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s</span></span>
<span><span class="co">##  s</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $t0</span></span>
<span><span class="co">##  t0</span></span>
<span><span class="co">##   1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s.w</span></span>
<span><span class="co">##     lR s.w s.w_lRright</span></span>
<span><span class="co">##   left   1           0</span></span>
<span><span class="co">##  right   1           1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.w</span></span>
<span><span class="co">##  m.w</span></span>
<span><span class="co">##    1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.d_pd</span></span>
<span><span class="co">##  m.d_pd</span></span>
<span><span class="co">##       1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s.d_pi</span></span>
<span><span class="co">##  s.d_pi</span></span>
<span><span class="co">##       1</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mapped_pars(design_posttrans)</span></span></code></pre></div>
<p>Notes: - If a trend parameter is not listed in <code>formula</code>,
an intercept-only formula is added automatically so it can still be
estimated. - For non-<code>premap</code> phases, the target parameter
names must exist in the cognitive model (e.g., <code>m</code>,
<code>s</code>, <code>t0</code> for LNR).</p>
</div>
</div>
<div class="section level2">
<h2 id="custom-c-trends">Custom C++ Trends<a class="anchor" aria-label="anchor" href="#custom-c-trends"></a>
</h2>
<p>You can register your own C++ kernel function. The function takes
per‑trial kernel parameters <code>trend_pars</code> (base params
excluded) and an input matrix, and returns a vector of outputs. To keep
this vignette fast and portable, we show the code and how to register it
but do not actually compile or run it here.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ampl-psych.github.io/EMC2/">EMC2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write a custom kernel to a separate file</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".cpp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"// [[Rcpp::depends(EMC2)]]"</span>,</span>
<span>  <span class="st">"#include &lt;Rcpp.h&gt;"</span>,</span>
<span>  <span class="st">"#include \"EMC2/userfun.hpp\""</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="st">"// Example: two params (a, b) and two inputs (covariate1, t0)"</span>,</span>
<span>  <span class="st">"Rcpp::NumericVector custom_kernel(Rcpp::NumericMatrix trend_pars, Rcpp::NumericMatrix input) {"</span>,</span>
<span>  <span class="st">"  int n = input.nrow();"</span>,</span>
<span>  <span class="st">"  Rcpp::NumericVector out(n, 0.0);"</span>,</span>
<span>  <span class="st">"  for (int i = 0; i &lt; n; ++i) {"</span>,</span>
<span>  <span class="st">"    double a = (trend_pars.ncol() &gt; 0) ? trend_pars(i, 0) : 0.0;"</span>,</span>
<span>  <span class="st">"    double b = (trend_pars.ncol() &gt; 1) ? trend_pars(i, 1) : 0.0;"</span>,</span>
<span>  <span class="st">"    double in1 = input(i, 0);  // covariate1"</span>,</span>
<span>  <span class="st">"    double in2 = input(i, 1);  // t0"</span>,</span>
<span>  <span class="st">"    if ((i % 2) == 0) out[i] = (Rcpp::NumericVector::is_na(in1) ? 0.0 : in1) + a;"</span>,</span>
<span>  <span class="st">"    else             out[i] = (Rcpp::NumericVector::is_na(in2) ? 0.0 : in2) * b;"</span>,</span>
<span>  <span class="st">"  }"</span>,</span>
<span>  <span class="st">"  return out;"</span>,</span>
<span>  <span class="st">"}"</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="st">"// Export pointer maker for registration"</span>,</span>
<span>  <span class="st">"// [[Rcpp::export]]"</span>,</span>
<span>  <span class="st">"SEXP EMC2_make_custom_kernel_ptr();"</span>,</span>
<span>  <span class="st">"EMC2_MAKE_PTR(custom_kernel)"</span></span>
<span><span class="op">)</span>, <span class="va">tf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Register with parameter names, transforms, and a default base</span></span>
<span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/register_trend.html">register_trend</a></span><span class="op">(</span></span>
<span>  trend_parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>  file <span class="op">=</span> <span class="va">tf</span>,</span>
<span>  transforms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="st">"identity"</span>, b <span class="op">=</span> <span class="st">"pnorm"</span><span class="op">)</span>,</span>
<span>  base <span class="op">=</span> <span class="st">"add"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use in a trend (note par_input to add t0 as an input column)</span></span>
<span><span class="va">trend_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_trend.html">make_trend</a></span><span class="op">(</span></span>
<span>  par_names  <span class="op">=</span> <span class="st">"m"</span>,</span>
<span>  cov_names  <span class="op">=</span> <span class="st">"covariate1"</span>,</span>
<span>  kernels    <span class="op">=</span> <span class="st">"custom"</span>,</span>
<span>  par_input  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"t0"</span><span class="op">)</span>,</span>
<span>  phase      <span class="op">=</span> <span class="st">"pretransform"</span>,</span>
<span>  bases      <span class="op">=</span> <span class="cn">NULL</span>,         <span class="co"># uses ct$base (here: add)</span></span>
<span>  custom_trend <span class="op">=</span> <span class="va">ct</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_custom_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  trend <span class="op">=</span> <span class="va">trend_custom</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">s</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">t0</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">m.a</span> <span class="op">~</span> <span class="va">lR</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="va">LNR</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Intercept formula added for trend_pars: m.b</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Sampled Parameters: </span></span>
<span><span class="co">## [1] "m"           "s"           "t0"          "m.a"         "m.a_lRright"</span></span>
<span><span class="co">## [6] "m.b"        </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Design Matrices: </span></span>
<span><span class="co">## $m</span></span>
<span><span class="co">##  m</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $s</span></span>
<span><span class="co">##  s</span></span>
<span><span class="co">##  1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $t0</span></span>
<span><span class="co">##  t0</span></span>
<span><span class="co">##   1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.a</span></span>
<span><span class="co">##     lR m.a m.a_lRright</span></span>
<span><span class="co">##   left   1           0</span></span>
<span><span class="co">##  right   1           1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $m.b</span></span>
<span><span class="co">##  m.b</span></span>
<span><span class="co">##    1</span></span></code></pre>
<p>Interpretation: the base controls how the custom kernel’s output
enters the parameter (e.g., <code>add</code> means additive). The
<code>transforms</code> declared in <code><a href="../reference/register_trend.html">register_trend()</a></code> are
attached to the model so custom kernel parameters can be estimated under
appropriate constraints.</p>
</div>
<div class="section level2">
<h2 id="tips-for-choosing-trends">Tips for Choosing Trends<a class="anchor" aria-label="anchor" href="#tips-for-choosing-trends"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Start simple: Begin with linear trends before moving to more complex
options</li>
<li>Match theory: Choose trends that align with theoretical
expectations</li>
<li>Consider interpretability: Simpler trends are often easier to
interpret</li>
<li>Watch for overfitting: More complex trends (like high-order
polynomials) may overfit</li>
<li>Use shared parameters when you expect related processes</li>
<li>Choose <code>phase</code> based on how the trend should interact
with mapping and transformations</li>
</ol>
</div>
<div class="section level2">
<h2 id="interpreting-bases-and-transforms">Interpreting Bases and Transforms<a class="anchor" aria-label="anchor" href="#interpreting-bases-and-transforms"></a>
</h2>
<ul>
<li>
<code>lin</code>: additive on the parameter scale
(<code>θ &lt;- θ + B0 * k</code>)</li>
<li>
<code>exp_lin</code>: additive on an exponentialized parameter
(<code>θ &lt;- exp(θ) + exp(B0) * k</code>)</li>
<li>
<code>centered</code>: centers <code>k</code> at 0.5 before scaling
(<code>θ &lt;- θ + B0*(k - 0.5)</code>)</li>
<li>
<code>add</code>: parameter is <code>θ &lt;- θ + k</code> (no base
parameter)</li>
<li>
<code>identity</code>: parameter is <code>θ &lt;- k</code> (no base
parameter)</li>
</ul>
<p>Trend parameters can have default transforms (from
<code><a href="../reference/trend_help.html">trend_help()</a></code>), and custom kernels can declare their own
transforms via <code><a href="../reference/register_trend.html">register_trend()</a></code>. These transforms feed into
the model’s transform pipeline, ensuring parameters respect intended
bounds.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niek Stevenson, Michelle Donzallaz, Andrew Heathcote.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
