<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimating Marginal Likelihoods Using WARP-III Bridge Sampling — run_bridge_sampling • EMC2</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating Marginal Likelihoods Using WARP-III Bridge Sampling — run_bridge_sampling"><meta name="description" content="Uses bridge sampling that matches a proposal distribution to the first three moments
of the posterior distribution to get an accurate estimate of the marginal likelihood.
The marginal likelihood can be used for computing Bayes factors and posterior model probabilities."><meta property="og:description" content="Uses bridge sampling that matches a proposal distribution to the first three moments
of the posterior distribution to get an accurate estimate of the marginal likelihood.
The marginal likelihood can be used for computing Bayes factors and posterior model probabilities."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EMC2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/DDM.html">Diffusion Decision Model (DDM)</a></li>
    <li><a class="dropdown-item" href="../articles/race-models.html">Race Models</a></li>
    <li><a class="dropdown-item" href="../articles/Simulation-based-Calibration.html">Simulation-based Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/trends.html">Trends</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ampl-psych/EMC2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimating Marginal Likelihoods Using WARP-III Bridge Sampling</h1>
      <small class="dont-index">Source: <a href="https://github.com/ampl-psych/EMC2/blob/main/R/bridge_sampling.R" class="external-link"><code>R/bridge_sampling.R</code></a></small>
      <div class="d-none name"><code>run_bridge_sampling.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Uses bridge sampling that matches a proposal distribution to the first three moments
of the posterior distribution to get an accurate estimate of the marginal likelihood.
The marginal likelihood can be used for computing Bayes factors and posterior model probabilities.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_bridge_sampling</span><span class="op">(</span></span>
<span>  <span class="va">emc</span>,</span>
<span>  stage <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>  filter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cores_for_props <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  cores_per_prop <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  both_splits <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-emc">emc<a class="anchor" aria-label="anchor" href="#arg-emc"></a></dt>
<dd><p>An emc object with a set of converged samples</p></dd>


<dt id="arg-stage">stage<a class="anchor" aria-label="anchor" href="#arg-stage"></a></dt>
<dd><p>A character indicating which stage to use, defaults to <code>sample</code></p></dd>


<dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>An integer or vector. If integer, it will exclude up until
that integer. If vector it will include everything in that range.</p></dd>


<dt id="arg-repetitions">repetitions<a class="anchor" aria-label="anchor" href="#arg-repetitions"></a></dt>
<dd><p>An integer. How many times to repeat the bridge sampling scheme. Can help get an estimate of stability of the estimate.</p></dd>


<dt id="arg-cores-for-props">cores_for_props<a class="anchor" aria-label="anchor" href="#arg-cores-for-props"></a></dt>
<dd><p>Integer. Warp-III evaluates the posterior over 4 different proposal densities. If you have the CPU, 4 cores will do this in parallel, 2 is also already helpful.</p></dd>


<dt id="arg-cores-per-prop">cores_per_prop<a class="anchor" aria-label="anchor" href="#arg-cores-per-prop"></a></dt>
<dd><p>Integer. Per density we can also parallelize across subjects. Eventual cores will be <code>cores_for_props</code> * <code>cores_per_prop</code>. For efficiency users should prioritize cores_for_props being 4.</p></dd>


<dt id="arg-both-splits">both_splits<a class="anchor" aria-label="anchor" href="#arg-both-splits"></a></dt>
<dd><p>Boolean. Bridge sampling uses a proposal density and a target density. We can estimate the stability of our samples and therefore MLL estimate, by running 2 bridge sampling iterations
The first one uses the first half of the samples as the proposal and the second half as the target, the second run uses the opposite. If this is is set to <code>FALSE</code>, it will only run bridge sampling once and
it will instead do an odd-even iterations split to get a more reasonable estimate for just one run.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional, optional more in-depth hyperparameters</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A vector of length repetitions which contains the marginal log likelihood estimates per repetition</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If not enough posterior samples were collected using <code><a href="fit.html">fit()</a></code>,
bridge sampling can be unstable. It is recommended to run
<code>run_bridge_sampling()</code> several times with the <code>repetitions</code> argument
and to examine how stable the results are.</p>
<p>It can be difficult to converge bridge sampling for exceptionally large models,
because of a large number of subjects (&gt; 100) and/or cognitive model parameters.</p>
<p>For a practical introduction:</p>
<p>Gronau, Q. F., Heathcote, A., &amp; Matzke, D. (2020). Computing Bayes factors
for evidence-accumulation models using Warp-III bridge sampling.
<em>Behavior research methods</em>, 52(2), 918-937. doi.org/10.3758/s13428-019-01290-6</p>
<p>For mathematical background:</p>
<p>Meng, X.-L., &amp; Wong, W. H. (1996). Simulating ratios of normalizing
constants via a simple identity: A theoretical exploration. <em>Statistica Sinica</em>,
6, 831-860. http://www3.stat.sinica.edu.tw/statistica/j6n4/j6n43/j6n43.htm</p>
<p>Meng, X.-L., &amp; Schilling, S. (2002). Warp bridge sampling.
<em>Journal of Computational and Graphical Statistics</em>,
11(3), 552-586. doi.org/10.1198/106186002457</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># After `fit` has converged on a specific model</span></span></span>
<span class="r-in"><span><span class="co"># We can take those samples and calculate the marginal log-likelihood for them</span></span></span>
<span class="r-in"><span><span class="va">MLL</span> <span class="op">&lt;-</span> <span class="fu">run_bridge_sampling</span><span class="op">(</span><span class="va">samples_LNR</span>, cores_for_props <span class="op">=</span> <span class="fl">1</span>, both_splits <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># This will run on 2*4 cores (since 4 is the default for ``cores_for_props``)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niek Stevenson, Michelle Donzallaz, Andrew Heathcote, Steven Miletić.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

