<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a trend specification for model parameters — make_trend • EMC2</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a trend specification for model parameters — make_trend"><meta name="description" content="Create a trend specification for model parameters"><meta property="og:description" content="Create a trend specification for model parameters"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EMC2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/DDM.html">Diffusion Decision Model (DDM)</a></li>
    <li><a class="dropdown-item" href="../articles/race-models.html">Race Models</a></li>
    <li><a class="dropdown-item" href="../articles/Simulation-based-Calibration.html">Simulation-based Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/trends.html">Trends</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ampl-psych/EMC2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a trend specification for model parameters</h1>
      <small class="dont-index">Source: <a href="https://github.com/ampl-psych/EMC2/blob/main/R/trend.R" class="external-link"><code>R/trend.R</code></a></small>
      <div class="d-none name"><code>make_trend.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a trend specification for model parameters</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make_trend</span><span class="op">(</span></span>
<span>  <span class="va">par_names</span>,</span>
<span>  cov_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">kernels</span>,</span>
<span>  bases <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  shared <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trend_pnames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  phase <span class="op">=</span> <span class="st">"premap"</span>,</span>
<span>  par_input <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  at <span class="op">=</span> <span class="st">"lR"</span>,</span>
<span>  maps <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  custom_trend <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ffill_na <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-par-names">par_names<a class="anchor" aria-label="anchor" href="#arg-par-names"></a></dt>
<dd><p>Character vector specifying which parameters to apply trend to</p></dd>


<dt id="arg-cov-names">cov_names<a class="anchor" aria-label="anchor" href="#arg-cov-names"></a></dt>
<dd><p>Character vector specifying which covariates to use for each trend</p></dd>


<dt id="arg-kernels">kernels<a class="anchor" aria-label="anchor" href="#arg-kernels"></a></dt>
<dd><p>Character vector specifying which kernel function to use for each trend</p></dd>


<dt id="arg-bases">bases<a class="anchor" aria-label="anchor" href="#arg-bases"></a></dt>
<dd><p>Optional character vector specifying which base function to use for each trend</p></dd>


<dt id="arg-shared">shared<a class="anchor" aria-label="anchor" href="#arg-shared"></a></dt>
<dd><p>Named list with entries the parameter names to be shared and the names the new names of the shared parameter.</p></dd>


<dt id="arg-trend-pnames">trend_pnames<a class="anchor" aria-label="anchor" href="#arg-trend-pnames"></a></dt>
<dd><p>Optional character vector specifying custom parameter names</p></dd>


<dt id="arg-phase">phase<a class="anchor" aria-label="anchor" href="#arg-phase"></a></dt>
<dd><p>Character vector (length 1 or <code>length(par_names)</code>) specifying the phase for each trend entry;
one of "premap", "pretransform", or "posttransform". Defaults to "premap".</p></dd>


<dt id="arg-par-input">par_input<a class="anchor" aria-label="anchor" href="#arg-par-input"></a></dt>
<dd><p>Optional character vector(s) of parameter names to use as additional inputs for the trend</p></dd>


<dt id="arg-at">at<a class="anchor" aria-label="anchor" href="#arg-at"></a></dt>
<dd><p>If NULL, trend is applied to every row in the <code>dadm</code>. If a factor name (e.g., "lR"), trend is applied only to entries
corresponding to the first level of that factor, and fed forward to the other levels of that factor. Defaults to "lR". For DDMs, <code>at</code> should be set to NULL.</p></dd>


<dt id="arg-maps">maps<a class="anchor" aria-label="anchor" href="#arg-maps"></a></dt>
<dd><p>List of functions that create matrices with which to multiply the covariates before applying the base. See details.</p></dd>


<dt id="arg-custom-trend">custom_trend<a class="anchor" aria-label="anchor" href="#arg-custom-trend"></a></dt>
<dd><p>A trend registered with <code>register_trend</code></p></dd>


<dt id="arg-ffill-na">ffill_na<a class="anchor" aria-label="anchor" href="#arg-ffill-na"></a></dt>
<dd><p>Determines how missing covariate values are handled.
If <code>TRUE</code>, missing values are forward-filled using the last known non-<code>NA</code> value after
applying the kernel. If <code>FALSE</code>, trials with missing covariates contribute <code>0</code> instead.
The default (NULL) is interpreted as <code>TRUE</code> for delta-rule models and <code>FALSE</code> otherwise.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the trend specifications for each parameter</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>maps</code> argument accepts one or more functions that translate trial-level
covariates into accumulator-specific predictors.</p>
<p>Example of a minimal map function:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">advantage_map</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dadm</span>, <span class="va">cov_names</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">lS</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'cov'</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dadm</span><span class="op">$</span><span class="va">lR</span> <span class="op">==</span> <span class="st">'left'</span>,  <span class="va">dadm</span><span class="op">$</span><span class="va">cov_left</span>,  <span class="va">dadm</span><span class="op">$</span><span class="va">cov_right</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">lSother</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'cov'</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dadm</span><span class="op">$</span><span class="va">lR</span> <span class="op">==</span> <span class="st">'right'</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_left</span>,  <span class="va">dadm</span><span class="op">$</span><span class="va">cov_right</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">plus</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cov_names</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lS</span>      <span class="op">==</span> <span class="va">x</span>,  <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">minus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cov_names</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lSother</span> <span class="op">==</span> <span class="va">x</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">plus</span> <span class="op">+</span> <span class="va">minus</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
<p>Multiple maps may be supplied, in which case the model will create a separate
base parameter for each map. See more examples below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Put trend on B and v parameters</span></span></span>
<span class="r-in"><span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fu">make_trend</span><span class="op">(</span></span></span>
<span class="r-in"><span>  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"v"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov_names <span class="op">=</span> <span class="st">"strial"</span>,</span></span>
<span class="r-in"><span>  kernels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp_incr"</span>, <span class="st">"poly3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  phase <span class="op">=</span> <span class="st">"premap"</span>,</span></span>
<span class="r-in"><span>  shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shrd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"B.B0"</span>, <span class="st">"v.d1"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="get_trend_pnames.html">get_trend_pnames</a></span><span class="op">(</span><span class="va">trend</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "B.w"    "B.d_ei" "v.d2"   "v.d3"   "shrd"  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using covariate maps</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Covariate maps allow you to specify how trial-by-trial covariates influence</span></span></span>
<span class="r-in"><span><span class="co"># model parameters for each accumulator. The example below uses a simple data</span></span></span>
<span class="r-in"><span><span class="co"># frame with two trials. `cov_left` and `cov_right` specify which covariates</span></span></span>
<span class="r-in"><span><span class="co"># correspond to the left and right accumulators on each trial. `S` indicates the</span></span></span>
<span class="r-in"><span><span class="co"># correct response, and `cov1`–`cov4` contain the actual covariate values.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  subjects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  S        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'left'</span>, <span class="st">'right'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span>, <span class="st">'4'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov_right<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'3'</span>, <span class="st">'2'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  rt       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">0.8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  R        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'left'</span>, <span class="st">'right'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov1     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov2     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov3     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  cov4     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A covariate map function must take `dadm` and `cov_names` as inputs and return</span></span></span>
<span class="r-in"><span><span class="co"># a matrix of size (nrow(dadm), length(cov_names)), coding how each covariate</span></span></span>
<span class="r-in"><span><span class="co"># contributes to each accumulator.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">advantage_map</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dadm</span>, <span class="va">cov_names</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Which stimulus does the accumulator correspond to on each trial?</span></span></span>
<span class="r-in"><span>  <span class="va">lS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'cov'</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dadm</span><span class="op">$</span><span class="va">lR</span> <span class="op">==</span> <span class="st">'left'</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_left</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_right</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Which stimulus does the *other* accumulator correspond to?</span></span></span>
<span class="r-in"><span>  <span class="va">lSother</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'cov'</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dadm</span><span class="op">$</span><span class="va">lR</span> <span class="op">==</span> <span class="st">'right'</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_left</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_right</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Build indicator matrices</span></span></span>
<span class="r-in"><span>  <span class="va">map_plus1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cov_names</span>, <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lS</span>     <span class="op">==</span> <span class="va">col</span>,  <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">map_minus1</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cov_names</span>, <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lSother</span> <span class="op">==</span> <span class="va">col</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">map_plus1</span> <span class="op">+</span> <span class="va">map_minus1</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A covariate map function can be supplied to make_trend(), which creates the mapping</span></span></span>
<span class="r-in"><span><span class="co"># specification for the model for each participant. Here, a single map ('differences') is provided.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fu">make_trend</span><span class="op">(</span></span></span>
<span class="r-in"><span>  par_names <span class="op">=</span> <span class="st">'v'</span>,</span></span>
<span class="r-in"><span>  kernels   <span class="op">=</span> <span class="st">'delta'</span>,</span></span>
<span class="r-in"><span>  bases     <span class="op">=</span> <span class="st">'lin'</span>,</span></span>
<span class="r-in"><span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cov1'</span>, <span class="st">'cov2'</span>, <span class="st">'cov3'</span>, <span class="st">'cov4'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  maps      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'differences'</span> <span class="op">=</span> <span class="va">advantage_map</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  at        <span class="op">=</span> <span class="st">'lR'</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">design_RDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="design.html">design</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  model  <span class="op">=</span> <span class="va">RDM</span>,</span></span>
<span class="r-in"><span>  data   <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  formula<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">B</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">v</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">t0</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  trend  <span class="op">=</span> <span class="va">trend</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Intercept formula added for trend_pars: v.w_differences, v.q0, v.alpha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Parameter(s) A, s not specified in formula and assumed constant.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Sampled Parameters: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "B"               "v"               "t0"              "v.w_differences"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "v.q0"            "v.alpha"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Design Matrices: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $t0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  t0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v.w_differences</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v.w_differences</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v.q0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v.q0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v.alpha</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v.alpha</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">emc</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_emc.html">make_emc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">design_RDM</span>, type <span class="op">=</span> <span class="st">'single'</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Because the model contains a delta rule, data will not be compressed.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing data set 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The resulting covariate maps for each subject are attached to the `dadm`:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">emc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">'covariate_maps'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $differences</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      cov1 cov2 cov3 cov4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0   -1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   -1    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0   -1    0    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    0    1    0   -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># And to confirm that this mapping is correct, compare with the corresponding `dadm`</span></span></span>
<span class="r-in"><span><span class="va">emc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   subjects     S cov_left cov_right  rt     R cov1 cov2 cov3 cov4 trials    lR</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        1  left        1         3 1.2  left    1   NA   NA    1      1  left</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        1  left        1         3 1.2  left    1   NA   NA    1      1 right</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        1 right        4         2 0.8 right   NA    1    1    1      2  left</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        1 right        4         2 0.8 right   NA    1    1    1      2 right</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   winner</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can also provide multiple covariate maps. Each additional map introduces</span></span></span>
<span class="r-in"><span><span class="co"># a separate base parameter. For example, the following `sum_map` is suitable</span></span></span>
<span class="r-in"><span><span class="co"># for RL-ARD–type models:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sum_map</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dadm</span>, <span class="va">cov_names</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Which stimulus does the accumulator correspond to on each trial?</span></span></span>
<span class="r-in"><span>  <span class="va">lS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'cov'</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dadm</span><span class="op">$</span><span class="va">lR</span> <span class="op">==</span> <span class="st">'left'</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_left</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_right</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Which stimulus does the *other* accumulator correspond to?</span></span></span>
<span class="r-in"><span>  <span class="va">lSother</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'cov'</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">dadm</span><span class="op">$</span><span class="va">lR</span> <span class="op">==</span> <span class="st">'right'</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_left</span>, <span class="va">dadm</span><span class="op">$</span><span class="va">cov_right</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Indicator matrices (note: both are added rather than subtracted)</span></span></span>
<span class="r-in"><span>  <span class="va">map_this</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cov_names</span>, <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lS</span>      <span class="op">==</span> <span class="va">col</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">map_other</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cov_names</span>, <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">lSother</span> <span class="op">==</span> <span class="va">col</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">map_this</span> <span class="op">+</span> <span class="va">map_other</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">trend</span> <span class="op">&lt;-</span> <span class="fu">make_trend</span><span class="op">(</span></span></span>
<span class="r-in"><span>  par_names <span class="op">=</span> <span class="st">'v'</span>,</span></span>
<span class="r-in"><span>  kernels   <span class="op">=</span> <span class="st">'delta'</span>,</span></span>
<span class="r-in"><span>  bases     <span class="op">=</span> <span class="st">'lin'</span>,</span></span>
<span class="r-in"><span>  cov_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cov1'</span>, <span class="st">'cov2'</span>, <span class="st">'cov3'</span>, <span class="st">'cov4'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  maps      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'differences'</span> <span class="op">=</span> <span class="va">advantage_map</span>,</span></span>
<span class="r-in"><span>                   <span class="st">'sums'</span>        <span class="op">=</span> <span class="va">sum_map</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  at        <span class="op">=</span> <span class="st">'lR'</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">design_RDM</span> <span class="op">&lt;-</span> <span class="fu"><a href="design.html">design</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  model  <span class="op">=</span> <span class="va">RDM</span>,</span></span>
<span class="r-in"><span>  data   <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  formula<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">B</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">v</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">t0</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  trend  <span class="op">=</span> <span class="va">trend</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Intercept formula added for trend_pars: v.w_differences, v.w_sums, v.q0, v.alpha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Parameter(s) A, s not specified in formula and assumed constant.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Sampled Parameters: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "B"               "v"               "t0"              "v.w_differences"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "v.w_sums"        "v.q0"            "v.alpha"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Design Matrices: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $t0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  t0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v.w_differences</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v.w_differences</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v.w_sums</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v.w_sums</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v.q0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v.q0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $v.alpha</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  v.alpha</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">emc</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_emc.html">make_emc</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">design_RDM</span>, type <span class="op">=</span> <span class="st">'single'</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Because the model contains a delta rule, data will not be compressed.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing data set 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now the dadm contains two covariate maps, and the model includes two</span></span></span>
<span class="r-in"><span><span class="co"># corresponding base parameters (e.g., v.w1 and v.w2):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">emc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">'covariate_maps'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $differences</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      cov1 cov2 cov3 cov4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0   -1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   -1    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0   -1    0    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    0    1    0   -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sums</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      cov1 cov2 cov3 cov4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    1    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    1    0    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    0    1    0    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niek Stevenson, Michelle Donzallaz, Andrew Heathcote, Steven Miletić.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

